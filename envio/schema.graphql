type User @entity {
  id: ID!
  address: String!
  totalInvested: BigDecimal!
  totalYieldEarned: BigDecimal!
  activeStrategies: Int!
  transactions: [Transaction!]! @derivedFrom(field: "user")
  yieldEvents: [YieldEvent!]! @derivedFrom(field: "user")
  createdAt: BigInt!
  updatedAt: BigInt!
}

type Transaction @entity {
  id: ID!
  hash: String!
  user: User!
  type: TransactionType!
  amount: BigDecimal!
  asset: String!
  protocol: String!
  gasUsed: BigInt!
  gasPrice: BigInt!
  blockNumber: BigInt!
  timestamp: BigInt!
  status: TransactionStatus!
}

type YieldEvent @entity {
  id: ID!
  user: User!
  transaction: Transaction!
  protocol: String!
  asset: String!
  amount: BigDecimal!
  apy: BigDecimal!
  yieldEarned: BigDecimal!
  timestamp: BigInt!
  blockNumber: BigInt!
}

type AgentActivity @entity {
  id: ID!
  user: User!
  agentType: AgentType!
  action: String!
  amount: BigDecimal!
  asset: String!
  protocol: String!
  gasCondition: Int!
  yieldCondition: BigDecimal!
  executionCount: Int!
  lastExecution: BigInt!
  nextExecution: BigInt!
  status: AgentStatus!
  createdAt: BigInt!
}

type PermissionGrant @entity {
  id: ID!
  user: User!
  permissionHash: String!
  target: String!
  amount: BigDecimal!
  expiry: BigInt!
  isActive: Boolean!
  grantedAt: BigInt!
  revokedAt: BigInt
}

type DailyStats @entity {
  id: ID! # Format: YYYY-MM-DD
  date: String!
  totalUsers: Int!
  totalTransactions: Int!
  totalVolume: BigDecimal!
  totalYieldEarned: BigDecimal!
  avgGasPrice: BigDecimal!
  topProtocol: String!
}

enum TransactionType {
  DEPOSIT
  WITHDRAW
  SWAP
  PERMISSION_GRANT
  PERMISSION_REVOKE
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
}

enum AgentType {
  MASTER
  SUB_AGENT
  GAS_OPTIMIZER
  YIELD_HUNTER
  RISK_MANAGER
}

enum AgentStatus {
  ACTIVE
  PAUSED
  COMPLETED
  FAILED
}